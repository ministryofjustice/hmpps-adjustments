{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{#
This macro returns a remand summary.
The params are wrapped inside the attributes object and are as follows:
  adjustment (mandatory)
  offences (mandatory)
  prisonerDetail (mandatory)
  isEdit (optional) true/false
#}
{% macro remandSummary(attributes) %}
  {% set adjustment = attributes.adjustment %}
  {% set offences = attributes.offences %}
  {% set offenderNo = attributes.offenderNo %}
  {% set isEdit = attributes.isEdit %}

  {{ govukSummaryList({
    rows: [
      {
        key: {
        text: "Remand period"
      },
        value: {
        text: adjustment.fromDate | date("DD MMM YYYY") + ' to ' + adjustment.toDate | date("DD MMM YYYY")
      },
        actions: {
        items: [
          {
            href: '/' + offenderNo + '/remand/dates/edit/' + adjustment.id,
            text: "Edit"
          }
        ]
      } if (isEdit)
      },
      {
        key: {
        text: "Offences"
      },
        value: {
        html: offenceList(offences)
      },
        actions: {
        items: [
          {
            href: '/' + offenderNo + '/remand/offences/edit/' + adjustment.id,
            text: "Edit"
          }
        ]
      } if (isEdit)
      },
      {
        key: {
        text: "Days spent on remand"
      },
        value: {
        text: adjustment.daysBetween or adjustment.effectiveDays
      },
        actions: {
        items: [
          {
            href: '#',
            text: "Edit"
          }
        ]
      } if (isEdit)
      }
    ]
  }) }}
{% endmacro %}

{% macro offenceList(offences) %}
  <ul class='govuk-list'>
    {% for o in offences %}
      <li>
        {{ o.offenceDescription }}
        <br>
        <span class="govuk-hint">
                    {{ offenceCommittedText(o) }}
                </span>
      </li>
    {% endfor %}
  </ul>
{% endmacro %}


{% macro offenceCommittedText(offence) %}
  {% if (offence.offenceEndDate and offence.offenceStartDate and offence.offenceEndDate !== offence.offenceStartDate) %}
    Committed from {{ offence.offenceStartDate | date("DD MMM YYYY") }} to {{ offence.offenceEndDate | date("DD MMM YYYY") }}
    {% elif offence.offenceStartDate %}
    Committed on {{ offence.offenceStartDate | date("DD MMM YYYY") }}
    {% elif offence.offenceEndDate %}
    Committed on {{ offence.offenceEndDate | date("DD MMM YYYY") }}
  {% else %}
    Offence date not entered
  {% endif %}
{% endmacro %}
